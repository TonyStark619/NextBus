<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NextBus – Timings</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="brand"><a href="index.html" style="color:inherit;text-decoration:none"><img src="/favicon.svg" alt="NextBus" style="height:24px;vertical-align:middle;margin-right:8px">NextBus</a></div>
      <nav class="nav">
        <a href="index.html" data-i18n="home">Home</a>
        <a href="features.html" data-i18n="features">Features</a>
        <a href="download.html" data-i18n="download">Download</a>
        <a href="contact.html" data-i18n="contact">Contact</a>
        <a href="settings.html" data-i18n="settings">Settings</a>
      </nav>
    </header>
    <main class="layout" style="grid-template-columns: 1fr;">
      <section class="controls" style="position:static;">
        <h2 data-i18n="timings">Timings</h2>
        <div id="list"></div>
      </section>
    </main>
    <footer class="footer">
      <a href="privacy.html">Privacy Policy</a> · <a href="terms.html">Terms & Conditions</a>
    </footer>
    <script type="module">
      import { applyTranslations } from './i18n.js';
      try { applyTranslations(); } catch (_e) {}
      const SERVER_ORIGIN = localStorage.getItem('server_origin') || 'http://localhost:619';
      const list = document.getElementById('list');
      async function load(){
        const [stopsRes, linesRes] = await Promise.all([
          fetch(`${SERVER_ORIGIN}/stops`), fetch(`${SERVER_ORIGIN}/lines`)
        ]);
        if(!stopsRes.ok || !linesRes.ok) { list.textContent = 'Failed to load'; return; }
        const [stops, lines] = await Promise.all([stopsRes.json(), linesRes.json()]);
        const byId = Object.fromEntries(stops.map(s=>[s.id,s]));
        const html = lines.slice(0, 50).map(l=>{
          const names = l.patternStopIds.map(id=>byId[id]?.name||id).join(' → ');
          return `<div style="margin:10px 0;padding:10px;background:#0e1726;border:1px solid #1f2a3a;border-radius:8px">
            <div style="font-weight:600;margin-bottom:6px">${l.name}</div>
            <div style="font-size:13px;color:#9fb3ca;margin-bottom:6px">${names}</div>
            <div style="font-size:13px">Headway: ${l.headwayMinutes} min</div>
          </div>`;
        }).join('');
        list.innerHTML = html;
      }
      load();
    </script>
  </body>
  </html>


